var datatable;var variable_datatable;var datatype="";var vartype="";var hasKnwl=false;var step_btn="step1btn";function updateTable(){var a=ws_tetrad_url+"/data/varTypeId/"+vartype+"/"+datatype;$.ajax({url:encodeURI(a),dataType:"json",type:"GET",success:function(b){datatable.clear();datatable.rows.add(b);datatable.draw()},error:function(b,d,c){alert("Unable to fetch dataset.")}});disableButtonsAtStep1()}function listSelectAction(a,b){$("#step1NextBtn").prop("disabled",false);$('input:hidden[name="dataFileId"]').val(a.cell(b,0).data());$(".dataset_name").html(a.cell(b,1).data());$("#data_type").html(datatype.toLowerCase());$("#var_type").html($('input:radio[name="varTypeId"]:checked').next().text().toLowerCase())}function disableButtonsAtStep1(){$("#step1NextBtn").prop("disabled",true);$("#step2btn").prop("disabled",true);$("#step3btn").prop("disabled",true);$("#step4btn").prop("disabled",true)}function disableButtonsAtStep2(){$("#step2NextBtn").prop("disabled",true);$("#step3btn").prop("disabled",true);$("#step4btn").prop("disabled",true)}function fetchParameters(){var d=$("#algorithm :selected").val();var c=$("#score :selected").val();var e=$("#test :selected").val();var a=ws_tetrad_url+"/param/algo/"+d;var b={};if(c!==null){b.score=c}if(e!==null){b.test=e}a=a+"?"+$.param(b);$.ajax({url:a,dataType:"json",type:"GET",success:function(h){var j=$("#params");$("#params > .form-group").remove();var g="";$.each(h,function(r,v){var q=v.text;var m=v.value.trim();var w=v.minVal;var x=v.maxVal;var p=v.defaultVal.trim();var k=v.numeric;var n=v.aBoolean;var y='id="'+m+'" name="'+m+'"';var l;if(k){var u='<label for="'+m+'" class="control-label">'+q+"</label>";var t='<input type="number" class="form-control" min="'+w+'" max="'+x+'" '+y+' value="'+Number(p)+'" required="required" />';l='<div class="form-group">'+u+t+"</div>"}else{if(n){var u='<div class="checkbox"><label for="'+m+'" class="control-label">';var o;if(p){o='<input type="checkbox" '+y+' checked="checked" />'+q}else{o='<input type="checkbox" '+y+" />"+q}var s="</label></div>";l='<div class="form-group">'+u+o+s+"</div>"}else{var u="<label>"+q+"</label>";var t='<input class="form-control" '+y+' value="'+p+'" />';l='<div class="form-group">'+u+t+"</div>"}}g+=l});$(j).append(g);var f=$("#params_tbl > tbody");$(f).empty();var i;$.each(h,function(l,m){var k=m.text;var n=m.value;i+='<tr><td class="condensed"><strong>'+k+':</strong></td><td><span class="alert-warning" id="param_'+n+'"></span></td></tr>'});$(f).append(i)},error:function(f,h,g){alert(f.responseText)}});$(".algo_name").html($("#algorithm :selected").text().toLowerCase());$(".score_name").html($("#score :selected").text().toLowerCase());$(".test_name").html($("#test :selected").text().toLowerCase())}function fetchTests(b,c){if(!b){return}var a=$("#test");$.ajax({url:ws_tetrad_url+"/test/algo/"+b+"/varType/"+c,dataType:"json",type:"GET",success:function(d){a.empty();$.each(d.options,function(e,g){var f="<option value='"+g.value+"'>"+g.text+"</option>";a.append(f)});if(a.is(":empty")){a.prop("disabled",true)}else{a.val(d.defaultValue).change();a.prop("disabled",false)}},error:function(d,f,e){alert(d.responseText)}})}function fetchScores(b,c){if(!b){return}var a=$("#score");$.ajax({url:ws_tetrad_url+"/score/algo/"+b+"/varType/"+c,dataType:"json",type:"GET",success:function(d){a.empty();$.each(d.options,function(e,g){var f="<option value='"+g.value+"'>"+g.text+"</option>";a.append(f)});if(a.is(":empty")){a.prop("disabled",true)}else{a.val(d.defaultValue).change();a.prop("disabled",false)}},error:function(d,f,e){alert(d.responseText)}})}function fetchDescription(a){if(!a){return}$.ajax({url:ws_tetrad_url+"/description/algo/"+a,dataType:"text",type:"GET",success:function(b){$("#description").text(b)}})}function fetchAlgorithms(b){var a=$("#algorithm");$.ajax({url:ws_tetrad_url+"/algo/"+b+"/"+datatype+"?"+$.param({knowledge:hasKnwl}),dataType:"json",type:"GET",success:function(c){a.empty();$.each(c,function(d,f){var e="<option value='"+f.value+"'>"+f.text+"</option>";a.append(e)})},error:function(c,e,d){alert(c.responseText);disableButtonsAtStep2()},complete:function(){if(a.is(":empty")){a.prop("disabled",true);$("#description").text("");disableButtonsAtStep2();var d=$("#score");d.empty();d.prop("disabled",true);var c=$("#test");d.empty();c.prop("disabled",true)}else{a.prop("disabled",false);$("#step2NextBtn").prop("disabled",false);$("#algorithm option:first").attr("selected","selected");a.trigger("change")}}})}function updateParamSummary(){$("#params").find("input").each(function(){var b="#param_"+$(this).attr("id");var a=$(this).val();if($(this).attr("type")==="checkbox"){$(b).text($(this).prop("checked")?"yes":"no")}else{$(b).text(a)}})}$(document).ready(function(){$("#tetradForm").validate({rules:{dataFileId:{required:true},algorithm:{required:true},score:{required:true},test:{required:true},name:{maxlength:64,required:true},jvmMaxMem:{required:true,number:true,min:0,max:64}},messages:{dataFileId:{required:"Please select a dataset."},algorithm:{required:"Please select an algorithm."},score:{required:"Please select a score."},test:{required:"Please select a test of independence."},name:{maxlength:"Name cannot exceed 64 characters.",required:"Please enter a name for the job."},jvmMaxMem:{required:"Must be a number between 0 and 64.",min:"Must be at least 0.",max:"Must be at most 64."}},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block",errorPlacement:function(e,f){if(f.parent(".input-group").length){e.insertAfter(f.parent())}else{e.insertAfter(f)}}});var d=$('input:radio[name="varTypeId"]');var a=$('a[data-toggle="tab"]');var b=$("#single_datatable").DataTable({select:{style:"single"},sAjaxDataProp:"",aoColumns:[{mData:"id"},{mData:"name"},{mData:"creationTime"},{mData:"numOfCases"},{mData:"numOfVars"}],columnDefs:[{targets:0,visible:false,searchable:false},{render:function(e){return moment(e).format("MMM DD, YYYY hh:mm:ss A")},targets:2}],order:[[2,"asc"]]});var c=$("#multi_datatable").DataTable({select:{style:"single"},sAjaxDataProp:"",aoColumns:[{mData:"id"},{mData:"name"},{mData:"creationTime"}],columnDefs:[{targets:0,visible:false,searchable:false},{render:function(e){return moment(e).format("MMM DD, YYYY hh:mm:ss A")},targets:2}],order:[[2,"asc"]]});b.on("select",function(i,h,g,f){listSelectAction(h,f)});b.on("deselect",function(i,h,g,f){disableButtonsAtStep1()});c.on("select",function(i,h,g,f){listSelectAction(h,f)});c.on("deselect",function(i,h,g,f){disableButtonsAtStep1()});knowledge_datatable=$("#knowledge_datatable").DataTable({select:{style:"single"},sAjaxSource:ws_tetrad_url+"/knowledge",sAjaxDataProp:"",aoColumns:[{mData:"id"},{mData:"name"},{mData:"creationTime"}],columnDefs:[{targets:0,visible:false,searchable:false},{render:function(e){return moment(e).format("MMM DD, YYYY hh:mm:ss A")},targets:2}],order:[[2,"asc"]]});knowledge_datatable.on("select",function(i,h,g,f){$('input:hidden[name="knwlFileId"]').val(h.cell(f,0).data());$(".knwl_name").html(h.cell(f,1).data());hasKnwl=true});knowledge_datatable.on("deselect",function(i,h,g,f){$('input:hidden[name="knwlFileId"]').val(null);$(".knwl_name").html("");hasKnwl=false});variable_datatable=$("#variable_datatable").DataTable({select:{style:"single"},sAjaxSource:ws_tetrad_url+"/variable",sAjaxDataProp:"",aoColumns:[{mData:"id"},{mData:"name"},{mData:"creationTime"},{mData:"numOfVars"}],columnDefs:[{targets:0,visible:false,searchable:false},{render:function(e){return moment(e).format("MMM DD, YYYY hh:mm:ss A")},targets:2}],order:[[2,"asc"]]});variable_datatable.on("select",function(i,h,g,f){$('input:hidden[name="varFileId"]').val(h.cell(f,0).data());$(".exclude_vars_name").html(h.cell(f,1).data())});variable_datatable.on("deselect",function(i,h,g,f){$('input:hidden[name="varFileId"]').val(null);$(".exclude_vars_name").html("")});$(a).click(function(){var e=$(this).attr("id");if(e!==datatype){datatype=e;switch(datatype){case"single":datatable=b;$('input:hidden[name="singleDataFile"]').val(true);break;case"multiple":datatable=c;$('input:hidden[name="singleDataFile"]').val(false);break}updateTable()}});$(d).click(function(){var e=$(this).val();if(e!==vartype){vartype=e;updateTable()}});$('input:radio[name="algoType"]').click(function(){fetchAlgorithms($(this).val())});$("#algorithm").change(function(){var e=$("#algorithm :selected").val();var f=$("input[name=varTypeId]:checked").val();fetchScores(e,f);fetchTests(e,f);fetchDescription(e);$("#step4btn").prop("disabled",true)});$("#score").change(function(){$("#step4btn").prop("disabled",true)});$("#test").change(function(){$("#step4btn").prop("disabled",true)});$("#step1btn").click(function(f){step_btn=$(this).attr("id")});$("#step2btn").click(function(f){if(step_btn==="step1btn"){$("#algorithm").trigger("change")}step_btn=$(this).attr("id");$('input:radio[name="algoType"]:checked').click()});$("#step3btn").click(function(f){if(step_btn==="step2btn"){fetchParameters()}step_btn=$(this).attr("id")});$("#step4btn").click(function(f){if(step_btn==="step4btn"){return}updateParamSummary();step_btn=$(this).attr("id")});$("#clr_knwl_select").click(function(f){knowledge_datatable.rows().deselect()});$("#clr_var_select").click(function(f){variable_datatable.rows().deselect()});datatable=b;datatype=$(a).attr("id");vartype=$(d).filter(":checked").val();$('input:radio[name="algoType"]:checked').click();$('input:hidden[name="singleDataFile"]').val(true);$(".exclude_vars_name").html("");updateTable();disableButtonsAtStep1()});